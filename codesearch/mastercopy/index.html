<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Andrei Gudkov">
<title>Linux power tools: get and search source code in two minutes</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}audio,canvas,video{display:inline-block}audio:not([controls]){display:none;height:0}[hidden],template{display:none}script{display:none !important}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}a{background:transparent}a:focus{outline:thin dotted}a:active,a:hover{outline:0}h1{font-size:2em;margin:.67em 0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}mark{background:#ff0;color:#000}code,kbd,pre,samp{font-family:monospace,serif;font-size:1em}pre{white-space:pre-wrap}q{quotes:"\201C" "\201D" "\2018" "\2019"}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:0}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}button,input{line-height:normal}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}*,*::before,*::after{box-sizing:border-box;margin:0}body{font-family:Helvetica,Arial,sans-serif;font-size:16px;color:#222;line-height:1.5;max-width:55em;margin:0 auto}#content,#footnotes{padding-left:.5em;padding-right:.5em}strong{font-weight:bold}em{font-style:italic}:not(pre)>code{font-family:Courier,monospace;line-height:1.0}a{color:#0061c5;text-decoration:none}a:hover{text-decoration:underline}hr{border-width:0 0 1px 0;border-style:solid;border-color:#678}ul,ol{list-style-position:outside;padding-left:0;margin-left:2em}ul li ul,ul li ol,ol li ul,ol li ol{margin-left:1.414em}ul>li{list-style-type:square;font-size:80%}ul>li>*{font-size:125%}ol>li{font-weight:bold}ol>li>*{font-weight:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.dlist dt{color:#325d72;font-weight:bold}.dlist dt:not(:first-child){margin-top:1em}.dlist dd{margin-left:2em}td.hdlist1{color:#325d72;padding-right:.5em;vertical-align:top}td.hdlist2{padding-bottom:.5em}h1{font-size:28px;font-weight:normal;letter-spacing:-1px;color:white;background-color:#325d72;text-align:center;margin:0 0 .5em 0;padding:.05em .5em}@media print{h1{color:#325d72;background-color:white;font-weight:bold}}h1::after{content:':';width:0;overflow:hidden;display:inline-block;vertical-align:middle}.author{color:#325d72}.email::before{content:"<";color:#325d72}.email::after{content:">";color:#325d72}.author+br,.email+br{display:none}#author{padding-left:.5em}#toc{margin:1em 0 2em 0;padding-left:.5em}#toctitle{font-size:19px;font-weight:bold;color:#325d72;margin:.5em 0}#toc>ul{line-height:1.4;font-size:15px;margin:0 0 0 .5em}#toc ul li{list-style-type:none}#toc li{margin:0}.big{font-size:120%}.small{font-size:75%}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background-color:#00fafa;border-radius:2px;padding:0 3px}.black{color:"black"}.black-background{background-color:"black";border-radius:2px;padding:0 3px}.blue{color:#0000bf}.blue-background{background-color:#0000fa;border-radius:2px;padding:0 3px}.fuchsia{color:#bf00bf}.fuchsia-background{background-color:#fa00fa;border-radius:2px;padding:0 3px}.gray{color:#606060}.gray-background{background-color:#7d7d7d;border-radius:2px;padding:0 3px}.green{color:#006000}.green-background{background-color:#007d00;border-radius:2px;padding:0 3px}.lime{color:#00bf00}.lime-background{background-color:#00fa00;border-radius:2px;padding:0 3px}.maroon{color:#600000}.maroon-background{background-color:#7d0000;border-radius:2px;padding:0 3px}.navy{color:#000060}.navy-background{background-color:#00007d;border-radius:2px;padding:0 3px}.olive{color:#606000}.olive-background{background-color:#7d7d00;border-radius:2px;padding:0 3px}.purple{color:#600060}.purple-background{background-color:#7d007d;border-radius:2px;padding:0 3px}.red{color:#bf0000}.red-background{background-color:#fa0000;border-radius:2px;padding:0 3px}.silver{color:#909090}.silver-background{background-color:#bcbcbc;border-radius:2px;padding:0 3px}.teal{color:#006060}.teal-background{background-color:#007d7d;border-radius:2px;padding:0 3px}.white{color:#bfbfbf}.white-background{background-color:#fafafa;border-radius:2px;padding:0 3px}.yellow{color:#bfbf00}.yellow-background{background-color:#fafa00;border-radius:2px;padding:0 3px}table.tableblock{border:1px solid #91a7b3;margin-left:auto;margin-right:auto}table.tableblock>caption.title{text-align:left;margin-bottom:.5em}table.tableblock>colgroup>col{width:inherit !important}table.tableblock>tbody>tr>td{border-style:solid;border-color:#91a7b3;border-width:0 1px;padding:0 5px 2px 5px}table.tableblock>tbody>tr:nth-of-type(2n){background-color:#f3f5f7}p.tableblock{text-align:inherit}table.tableblock>thead>tr>td,table.tableblock>thead>tr>th,table.tableblock>tfoot>tr>td,table.tableblock>tfoot>tr>th{color:#325d72;font-weight:bold;line-height:1.35;padding:2px 5px;border:1px solid #91a7b3}table.tableblock>thead>tr>th,table.tableblock>thead>tr>td{border-bottom-width:2px}table.tableblock>tfoot>tr>th,table.tableblock>tfoot>tr>td{border-top-width:2px}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}div.listingblock{padding:.5em;border-style:solid;border-color:#678;border-width:0 0 0 2px;background-color:#f3f5f7;overflow:auto}div.listingblock .title{text-align:right}div.listingblock pre{font-family:Menlo,Consolas,Monaco,"Lucida Console",monospace;font-size:87.5%;white-space:pre;background-color:#f3f5f7 !important;margin:0}div.listingblock td.linenos{border-right:1px solid #91a7b3;padding-right:.67em}div.listingblock table.pyhltable div.linenodiv{color:#678;text-align:right}div.listingblock table.pyhltable td.code{padding-left:.67em}div.imageblock>div.content>img{max-width:98%}.text-indent{padding-left:2em}img.inlinemath{image-rendering:optimizequality;margin-top:.5ex}h2,h3,h4{font-weight:normal;color:#325d72;margin:0}h2{font-size:27px;letter-spacing:-1px;border-bottom:1px solid #91a7b3}h3{font-size:24px;letter-spacing:-0.75px}h4{font-size:21px;letter-spacing:-0.5px}.title{color:#325d72;font-weight:bold}#footer{font-size:80%;color:white;background-color:#325d72}@media print{#footer{color:#325d72;background-color:white;font-weight:bold}}#footer-text{text-align:center;padding:.5em}#footer-badges{display:none}span.footnote{vertical-align:super;font-size:80%}#footnotes>hr{display:none}#footnotes::before{display:block;border-bottom:1px solid #678;margin:.5em 0;content:"Notes";font-size:19px;font-weight:bold;color:#325d72}#footnotes .footnote{margin-left:.5em;font-size:15px}hr:not(:first-child){margin-top:1.5em}hr:not(:last-child){margin-bottom:1.5em}.imageblock:not(:last-child),.listingblock:not(:last-child),.tableblock:not(:last-child){margin-bottom:1em}p+*{margin-top:1em}.paragraph+*{margin-top:1em}p+.ulist,p+.olist,p+.dlist,p+.hdlist,.paragraph+.ulist,.paragraph+.olist,.paragraph+.dlist,.paragraph+.hdlist,.paragraph+.listingblock{margin-top:.5em !important}li *+.ulist,li *+.olist,li *+.dlist,li *+.hdlist{margin-top:.1em !important}.title:not(:first-child){margin-top:1.5em}.content+.title{margin-top:.5em !important}.title+*{margin-top:1.5em}.title+p,.title+.paragraph,.title+.ulist,.title+.olist,.title+.dlist,.title+.hdlist{margin-top:.5em !important}.ulist:not(:last-child){margin-bottom:1em}.olist:not(:last-child){margin-bottom:1em}li:not(:first-child){margin-top:.1em}.dlist:not(:last-child){margin-bottom:1em}.dlist:not(:first-child){margin-top:1em}.sect3:not(:last-child){margin-bottom:18px}.sect3:not(:first-child){margin-top:18px}h4:not(:last-child){margin-bottom:9px}.sect2:not(:last-child){margin-bottom:22px}.sect2:not(:first-child){margin-top:22px}h3:not(:last-child){margin-bottom:11px}.sect1:not(:last-child){margin-bottom:40px}.sect1:not(:first-child){margin-top:40px}#preamble:not(:last-child){margin-bottom:40px}h2:not(:last-child){margin-bottom:13px}#header:not(:last-child),#content:not(:last-child),#footnotes:not(:last-child){margin-bottom:2em}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}
</style>
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article">
<div id="header">
<h1>Linux power tools: get and search source code in two minutes</h1>
<div class="details">
<span id="author" class="author">Andrei Gudkov</span><br>
<span id="email" class="email"><a href="mailto:gudokk@gmail.com">gudokk@gmail.com</a></span><br>
</div>
</div>
<div id="content">
<div class="paragraph">
<p>Quick retrieving and searching source code is an underestimated skill.
For example, do you know the default user agent of wget?
You might want to know this to create <code>robots.txt</code> for your website.
Or have you ever wondered how random number generator is implemented in your favorite language?
Usually such questions are left without answers because
of the fears that it would take too much time to find out this information.
However, with the knowledge of proper linux commands you can find answer to any such question
in just couple of minutes and without leaving the console window.
I use the workflow described below so often that I find code search skill to be no
less important than the ability to solve algorithmic problems or use a debugger.</p>
</div>
<div class="paragraph">
<p>I will demonstrate workflow by example.
I use <code>top</code> command everyday.
Among other things, it displays load average numbers.
I would like to know where these numbers come from.
Is this some system call? Or does <code>top</code> compute these numbers itself?
I am interested in it because I want to reuse the same data source in my own monitoring dashboard.
For demonstration, I will use Debian as my favorite Linux flavor.
However, the commands are identical for all deb-based distributions including widespread Ubuntu.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="top.png" alt="top" width="75%">
</div>
</div>
<div class="paragraph">
<div class="title">1. Find the executable</div>
<p>My first step is to figure out the full path to the executable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">gudok@gudok6:~$</span> whereis top
<span class="tok-go">top: /usr/bin/top /usr/share/man/man1/top.1.gz</span>
<span class="tok-gp">gudok@gudok6:~$</span> readlink -f /usr/bin/top
<span class="tok-go">/usr/bin/top</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>readlink</code> command resolves any possible ambiguity that might be caused by symlinks.
Linux distributions use symlinks as a mechanism of switching between
multiple different executables which provide similar functionality.
For example <code>gcc</code> on my system resolves to the executable file through the following series of symlinks:
<code>/usr/bin/gcc</code> &#8594; <code>/usr/bin/gcc-6</code> &#8594; <code>/usr/bin/x86_64-linux-gnu-gcc-6</code>.
But on some other system it can point to other version of GCC or clang.
<code>readlink -f</code> follows all symlinks iteratively until it finds regular file.
The path that it prints is free of symlink components.</p>
</div>
<div class="paragraph">
<div class="title">2. Find the package</div>
<p>My next step is to find the package that installed the executable file.
The command varies across Linux distributions.
In Debian, Ubuntu and other deb-based distributives, it is <code>dpkg -S</code>.
The command accepts full path to some file in a filesystem and
prints package name file belongs to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">gudok@gudok6:~$</span> dpkg -S /usr/bin/top
<span class="tok-go">procps: /usr/bin/top</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now I know that <code>top</code> is part of <code>procps</code> package.</p>
</div>
<div class="paragraph">
<div class="title">3. Download source code of the package</div>
<p>Once I know the package name, I can now instruct <code>apt-get</code> to download its source code.
This is as easy as installing or removing packages: <code>apt-get source &lt;package&gt;</code>.
More than that, any user is entitled to use <code>source</code> subcommand, not only the root.
The command downloads the source package, unpacks it and even applies Debian patches.
So, in the end I have ready-to-use directory with the source code waiting for grepping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">gudok@gudok6:~$</span> <span class="tok-nb">cd</span> /tmp/
<span class="tok-gp">gudok@gudok6:/tmp$</span> apt-get <span class="tok-nb">source</span> procps
<span class="tok-go">Reading package lists... Done</span>
<span class="tok-go">Need to get 876 kB of source archives.</span>
<span class="tok-go">Get:1 http://cdn-fastly.deb.debian.org/debian stretch/main procps 2:3.3.12-3+deb9u1 (dsc) [2,333 B]</span>
<span class="tok-go">Get:2 http://cdn-fastly.deb.debian.org/debian stretch/main procps 2:3.3.12-3+deb9u1 (tar) [841 kB]</span>
<span class="tok-go">Get:3 http://cdn-fastly.deb.debian.org/debian stretch/main procps 2:3.3.12-3+deb9u1 (diff) [33.3 kB]</span>
<span class="tok-go">Fetched 876 kB in 0s (1,068 kB/s)</span>
<span class="tok-go">dpkg-source: info: extracting procps in procps-3.3.12</span>
<span class="tok-go">dpkg-source: info: unpacking procps_3.3.12.orig.tar.xz</span>
<span class="tok-go">dpkg-source: info: unpacking procps_3.3.12-3+deb9u1.debian.tar.xz</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that source code download is available only if <code>/etc/apt/sources.list</code> is configured correctly,
meaning that for every "deb" entry there should be an associated <code>deb-src</code> entry.
Like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>deb http://httpredir.debian.org/debian/ stretch main contrib non-free
deb-src http://httpredir.debian.org/debian/ stretch main contrib non-free

deb http://httpredir.debian.org/debian/ stretch-updates main
deb-src http://httpredir.debian.org/debian/ stretch-updates main</pre>
</div>
</div>
<div class="paragraph">
<p>In (hopefully) rare cases <code>sources.list</code> lacks deb-src entries
and there is no root access to fix it.
Package source code can be still downloaded in a hard way by using web UI.
Point you browser to <a href="https://packages.debian.org">packages.debian.org</a>
(or <a href="https://packages.ubuntu.com">packages.ubuntu.com</a>)
and use search form.
Eventually, you should come across package page that lists URL to the source code archive among other things:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="procps.png" alt="procps" width="80%">
</div>
</div>
<div class="paragraph">
<p>The first URL points to the actual source code of the package,
while the second one is a small archive that contains Debian related scripts and patches.
Typically you need to download only the first one.</p>
</div>
<div class="paragraph">
<div class="title">4. Grepping the code</div>
<p>Now it&#8217;s just a matter of choosing robust keywords and fast typing.
It seems to me that the starting point would be to locate the literal string "load average:",
because it the string that I see in the UI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">gudok@gudok6:/tmp/procps-3.3.12$</span> grep -R <span class="tok-s1">&#39;load average:&#39;</span> .
<span class="tok-go">Binary file ./po/pl.gmo matches</span>
<span class="tok-go">./po/uk.po:&quot;   color - 04:25:44 up 8 days, 50 min,  7 users,  load average:\n&quot;</span>
<span class="tok-go">./po/de.po:&quot;   color - 04:25:44 up 8 days, 50 min,  7 users,  load average:\n&quot;</span>
<span class="tok-go">Binary file ./po/vi.gmo matches</span>
<span class="tok-go">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First attempt produces too many false positives from documentation and translation files.
So, I rerun the search but limit search scope only to source and header files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">gudok@gudok6:/tmp/procps-3.3.12$</span> grep -R <span class="tok-s1">&#39;load average:&#39;</span> <span class="tok-k">$(</span>find . -name <span class="tok-s2">&quot;*.[hc]&quot;</span><span class="tok-k">)</span>
<span class="tok-go">./top/top_nls.c:      &quot;   color - 04:25:44 up 8 days, 50 min,  7 users,  load average:\n&quot;</span>
<span class="tok-go">./proc/whattime.c:    pos += sprintf(buf + pos, &quot; load average: %.2f, %.2f, %.2f&quot;,</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is much better.
There are only two matches.
And it is obvious that the second one is the one I need.
Let&#8217;s look inside it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">gudok@gudok6:/tmp/procps-3.3.12$</span> grep -C <span class="tok-m">4</span> <span class="tok-s1">&#39;load average:&#39;</span> proc/whattime.c
<span class="tok-go">    pos += sprintf(buf + pos, &quot;%2d user%s, &quot;, numuser, numuser == 1 ? &quot;&quot; : &quot;s&quot;);</span>

<span class="tok-go">    loadavg(&amp;av[0], &amp;av[1], &amp;av[2]);</span>

<span class="tok-go">    pos += sprintf(buf + pos, &quot; load average: %.2f, %.2f, %.2f&quot;,</span>
<span class="tok-go">                   av[0], av[1], av[2]);</span>
<span class="tok-go">  }</span>

<span class="tok-go">  if (human_readable) {</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All three load average values come from <code>loadavg()</code> function.
Let&#8217;s search for its definition.
We are lucky that procps coding style puts open curly bracket on the same line as function name.
This allows me to use basic regular expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">gudok@gudok6:/tmp/procps-3.3.12$</span> grep -R <span class="tok-s1">&#39;loadavg.*{&#39;</span> <span class="tok-k">$(</span>find . -name <span class="tok-s2">&quot;*.[hc]&quot;</span><span class="tok-k">)</span>
<span class="tok-go">./proc/sysinfo.c:void loadavg(double *restrict av1, double *restrict av5, double *restrict av15) {</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, <code>sysinfo.c</code> source code reveals that the values come from <code>/proc/loadavg</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><span></span><span class="tok-cp">#define LOADAVG_FILE &quot;/proc/loadavg&quot;</span>
<span class="tok-p">...</span>
<span class="tok-kt">void</span> <span class="tok-n">loadavg</span><span class="tok-p">(</span><span class="tok-kt">double</span> <span class="tok-o">*</span><span class="tok-kr">restrict</span> <span class="tok-n">av1</span><span class="tok-p">,</span> <span class="tok-kt">double</span> <span class="tok-o">*</span><span class="tok-kr">restrict</span> <span class="tok-n">av5</span><span class="tok-p">,</span> <span class="tok-kt">double</span> <span class="tok-o">*</span><span class="tok-kr">restrict</span> <span class="tok-n">av15</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-p">...</span>
    <span class="tok-n">FILE_TO_BUF</span><span class="tok-p">(</span><span class="tok-n">LOADAVG_FILE</span><span class="tok-p">,</span><span class="tok-n">loadavg_fd</span><span class="tok-p">);</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">sscanf</span><span class="tok-p">(</span><span class="tok-n">buf</span><span class="tok-p">,</span> <span class="tok-s">&quot;%lf %lf %lf&quot;</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">avg_1</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">avg_5</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">avg_15</span><span class="tok-p">)</span> <span class="tok-o">&lt;</span> <span class="tok-mi">3</span><span class="tok-p">)</span> <span class="tok-p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Task is complete.</p>
</div>
<div class="paragraph">
<div class="title">Exercises</div>
<p>Answer the questions by following the above workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>How is <code>strstr()</code> library function implemented in glibc?</p>
</li>
<li>
<p>What is the default seed value in <code>java.util.Random</code>?
Will two different invocations of <code>new Random().nextInt()</code> produce identical results?
And what if they were invoked in different threads?</p>
</li>
<li>
<p>What is the default User-Agent of wget? Of curl?</p>
</li>
<li>
<p>Find out inside linux kernel which factors affect the process that is killed
when system runs out of memory (so-called OOM killer).
Hint: every process has <code>/proc/&lt;fd&gt;/oom_score_adj</code> file that allows to tweak
OOM score.
You can use this file name as starting point of your searches.</p>
</li>
</ol>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-05-22 20:12:28 UTC
</div>
</div>
</body>
</html>